<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
</head>
<body>
    <div class="container flex flex-col">
        <input type="file" id="image-file" accept="image/*" >
        <img src="" alt="" id="image-show" class="object-contain h-64">
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const imageInput = document.getElementById('image-file');
                const uploadedImage = document.getElementById('image-show');
                imageInput.addEventListener('change', function(){
                    const file = imageInput.files[0];
                    if (file){
                        const reader = new FileReader();
                        reader.onload = function (event){
                            uploadedImage.src = event.target.result;
                            console.log("output:", event.target.result);
                        };
                        reader.readAsDataURL(file);
                    }
                })
            });
        </script>
        <button class="border mt-5" id="detect">detect it</button>
        <script>
            $(document).ready(function() {

                // sending a connect request to the server.
                var socket = io.connect();

                // An event handler for a change of value 
                $('button#detect').on('click', function(event) {
                    const imageInput = $('#image-file')[0];
                    const imageFile = imageInput.files[0];
                    console.log('detect click');
                    console.log(imageFile);

                    if (imageFile) {
                        const reader = new FileReader();
                        reader.onload = function(event){
                            const imageBase64 = event.target.result.split(',')[1];
                            socket.emit('image', imageBase64);
                            console.log('Image sent');
                        }

                        reader.readAsDataURL(imageFile)
                    }

                });

                socket.on('get image', function(msg) {
                    console.log(msg);
                });
            });
        
        </script>
    </div>
</body>
</html>
